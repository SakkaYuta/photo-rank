# 要件定義書 v5.0 - 製造マーケットプレイス型（最終）

## ビジョン
- 誰でも推し活グッズを作成・販売でき、工場（製造パートナー）が自由参入・競争できるオープンなマーケットプレイス。

## ビジネスモデル（v3.1 → v5.0）
- v3.1: 固定の製造API依存（SUZURI/pixivFACTORY/OPJ/ME-Q）。価格は各社固定原価前提。
- v5.0: 製造パートナー登録制のマーケットプレイス。工場が自由に参入・価格設定・納期提示。プラットフォームは運営・品質保証・マッチングを担う。

## ステークホルダー
- クリエイター: 複数工場の見積/納期/評価を比較して選択、利益設定を行う。
- オーガナイザー: 所属クリエイターの管理・出品承認・売上受領（変わらず）。
- 製造パートナー（工場）: 参入登録、製造可能商品と価格/納期の提示、受注・製造・発送、評価対象。
- プラットフォーム: マーケットプレイス運営、品質担保、マッチング、決済、支払い運用。

## 価格構造（二段階手数料）
- 販売価格 = (工場原価 × 1.1 + クリエイター利益) ÷ 0.7
- 手数料
  - 原価手数料: 工場原価の10%
  - 販売手数料: 販売価格の30%
- 目安: プラットフォーム総取り分は約34〜35%

## 主要フロー（v5.0）
1) 工場登録→審査→公開
2) 工場が製造可能商品・価格・リードタイムを登録（随時更新）
3) クリエイターが商品作成→複数工場の見積を閲覧→選択/自動最適化
4) オーガナイザー承認（所属の場合）
5) 注文→最適工場に自動アサイン→工場が製造・発送
6) 受領→評価（レビュー）→将来のランキング/マッチングに反映

## データベース（差分の要点）
- 新規
  - manufacturing_partners（工場）
  - factory_products（工場ごとの製造可能商品/価格/納期）
  - manufacturing_orders（製造指示・進捗）
  - partner_notifications（工場向け通知ログ）
  - partner_reviews（工場評価）
  - price_history（価格変更履歴）
- 変更（拡張）
  - purchases（注文）: 工場支払額、二段階手数料、総収益の列を追加
- 廃止/非推奨
  - 固定APIキーに依存したAPI連携設定（SUZURI等）

## API（工場向け）要件（概要）
- 認証: トークン（パートナー用APIキー/OAuthクライアント）
- エンドポイント（例）
  - GET /partner/me（プロフィール/審査状況）
  - GET/POST /partner/products（製造可能商品/価格/納期のCRUD）
  - GET /partner/orders?status=…（受注一覧）
  - POST /partner/orders/:id/accept（受注確定）
  - POST /partner/orders/:id/ship（出荷・追跡番号）
  - POST /partner/availability（休止/再開、キャパシティ）

## マッチング要件（概要）
- 入力: 商品タイプ、数量、希望納期、価格上限、工場評価
- 出力: マッチ度スコア（価格/納期/評価/距離/実績）で最適工場候補を提示
- 戦略: 初期は重み付き合計、将来は学習ベース/制約最適化へ拡張

## 透かし・画像保護
- SharpベースのSVG透かし（パターン/斜角/不透明度）
- 非オーナーは透かし付プレビューのみ、製造時のみ原画像アクセス

## 支払い
- 末締め翌々月末払い・最低5,000円・振込手数料250円（据え置き）
- 振込は手動運用（ready_for_transfer→completed）

## KPI
- 3ヶ月: 工場20社、クリエイター100名、月間注文1,000件、月商230万円
- 12ヶ月: 工場100社、クリエイター1,000名、月間注文5,000件、月商1,150万円、年商1.38億円

